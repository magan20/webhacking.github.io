<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>[20200229_TIL_11]</title>
    </head>
    <body>
        <h1>11. 애플리케이션 로직 공격</h1>
        <ul>
            <li>모든 웹 애플리케이션은 내부 함수를 실행하기 위해 자체적으로 보유하고 있는 로직을 이용한다.</li>
            <li>애플리케이션 로직 결함은 쉽게 발견되지 않기 때문에 취약점이 가진 특징을 명확히 정의하기 힘들다.</li>
            <div>
                <h2>1. 로직 결함의 특징</h2>
                <ul>
                    <li>애플리케이션에서 발생하는 로직 결함은 코드의 여러 라인에서 발견되는 간단한 버그에서부터 애플리케이션의 핵심 컴퓨논트의 상호작용으로 발생하는 복잡한 취약점까지 정말 다양하다.</li>
                    <li>로직 결함에는 일반적으로 발견되는 시그니처가 존재하지 않는다.</li>
                    <li>로직 결함의 다양한 설질을 알고 그것을 막거나 피하기 위해서는 가끔 논리적인 생각이 필요하며, 이런 논리적 생각은 로직 결함을 피하기 위한 꽤 좋은 방안이다.</li>
                </ul>
            </div>
            <div>
                <h2>2. 현실적으로 존재하는 로직 결함</h2>
                <ul>
                    <li>로직 결함을 앙아보는 가장 졸은 방법은 이론적으로 접근하기 보다 실제 예를 통해 알아보는 것이다.</li>
                    <li>개인적으로 로직 결함은 서로 많이 다르지만 서로 간에는 공통적인 면이 존재하며, 이런 로직 결함을 통해 개발자가 자주 저지르는 실수를 알수 있다.</li>
                    <div>
                        <h3>2_1. 예제1: 취약한 비밀번호 변경 함수</h3>
                        <ul>
                            <div>
                                <h4>2_1_1. 기능</h4>
                                <ul>
                                    <li>애플리케이션의 비밀번호 변경 함수는 사용자에 의해 수행된다.</li>
                                    <li>비밀번호 변경 함수에는 사용자가 사용자명 입력람을 채웠는지, 비밀번호를 입력했는지, 새로운 비밀번호인지, 세로운 비밀번호를 확인하는지 등의 기능이 있어야 한다.</li>
                                    <li>또한 모든 회원의 비밀번호를 변경할 수 있는 관리자만을 위한 비밀번호 변경 함수도 있어야 한다.</li>
                                </ul>
                            </div>
                            <div>
                                <h4>2_1_2. 가정</h4>
                                <ul>
                                    <li>클라인언트 측 인터페이스에는 사용자인지 관리자인지를 구별해 주는 요소(매개변수)가 존재하는데 서버 측 애플리케이션이 비밀번호를 변경할 때 이 매개변수의 존재 유무에 따라 고나리자로부터 온 것인지 일반 사용자로부터 온 것인지를 구별한다.</li>
                                </ul>
                            </div>
                            <div>
                                <h4>2_1_3. 공격</h4>
                                <ul>
                                    <li>앞에서 한 가정과 유사한 가정이 세워지면 사용자는 자신이 요청하는 모든 값을 제어하는 것이 가능하기 때문에 정상 사용자가 현재 비밀번호 매개변수를 포함하지 않는 요청을 할 수 도 있다.</li>
                                    <li>이런 로직 결함을 이용해서 공격자는 다른 모든 사용자의 비밀번호를 재설정 할 수 있다.</li>
                                    <li>해킹 단계</li>
                                    <ol>
                                        <li>로직 결함을 발견하기 위해 주요 함수를 면밀히 조사할 떄 입력되는 각 매개변수와 쿠키, 쿼리 문자 필드와 POST 데이터 값을 차례대로 제거해 본다.</li>
                                        <li>매개변수의 값뿐만 아니라 매개변수의 실제 이름까지도 제거됐음을 확인한다. 서버에서 다른 방법으로 제어될 수 있는 빈 문자를 정대 입력하지 않도록 한다.</li>
                                        <li>애플리케이셔니 허용하는 범위 내에 존재하는 모든 코드에 대해 한 번에 하나의 매개 변수만 공격하게 한다.</li>
                                    </ol>
                                </ul>
                            </div>
                        </ul>
                    </div>
                    <div>
                        <h3>2_2. 예제2: 체크아웃을 위한 절차</h3>
                        <ul>
                            <div>
                                <h4>2_2_1. 기능</h4>
                                <ul>
                                    <li>다음은 단계별로 주문을 하는 과정이다.</li>
                                    <ol>
                                        <li>상품 카테고리를 검색하고 선택한 아이템을 장바구니에 추가한다.</li>
                                        <li>장바구니로 가서 주문을 승인한다.</li>
                                        <li>결제 정보를 입력한다.</li>
                                        <li>배달 정보를 입력한다.</li>
                                    </ol>
                                </ul>
                            </div>
                            <div>
                                <h4>2_2_2. 가정</h4>
                                <ul>
                                    <li>개발자는 항상 사용자가 개발자 자신이 의도한 순서대로 각 단계에 접근할 것이라 생각한다.</li>
                                </ul>
                            </div>
                            <div>
                                <h4>2_2_3. 공격</h4>
                                <ul>
                                    <li>위에서와 같은 개발자의 가정에는 명백히 결함이 존재한다. 사용자는 모든 요청을 제어하고 2단계에서 결제를 하지 않고 바로 4단계로 넘어갈 수 있다.</li>
                                    <li>이런 종류의 결함을 찾고 공격하는 기술은 강제 검색 기술로 알려저 있다.</li>
                                    <li>강제 검색 기술은 브라우저 내에 순차적으로 존재하는 제어 프로세스를 우회하는 기법이란 할 수 있음.</li>
                                    <li>해킹 단계</li>
                                    <ol>
                                        <li>다단계 프로세스가 순차적인 요청으로 이뤄저 있을 때 예상되는 순서를 벋어나는 요청을 보내본다. 하나 이상의 다음단계로 넘어간 후 다시 이전 단계로 접근하는 시도를 해본다.</li>
                                        <li>여러 URL에 GET이나 POST 요청을 통해 순차적으로 접근하거나 동일한 URL에 다른 매개변수 값을 입력함으로써 각 단계의 결과에 도달할 수 있을 것이다. 각 단계는 요청된 매개변수 내의 함수 이름이나 인덱스를 통해 접속할 수 있을 것이다.</li>
                                        <li>개발자가 내부 기능에 어떤 가정을 세웠는지 살펴보고, 어느 부분을 중점적으로 공격할 수 있을 지에 대해 생각해본다. 애플리케이션 내 비정상적인 행동을 유발하기 위해 세워진 가정을 위반하는 방법에 대해서도 생각해 본다.</li>
                                        <li>다단계의 함수에 무작위로 접근할 경우 흔히 애플리케이션 내에 존재하는 다양한 예외사항에 부딪히게 된다. 이런 상황에서 애플리케이션은 혀재 공격이나 그 외의 다른 공격에 응용할</li>
                                    </ol>
                                </ul>
                            </div>
                        </ul>
                    </div>
                </ul>
            </div>
        </ul>
    </body>
</html>
