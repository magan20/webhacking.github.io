<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>[20200226_TIL_08]</title>
    </head>
    <body>
        <h1>08. 접근통제 공격</h1>
        <ul>
            <li>접근통제는 세션을 관리하고 사용자를 인증하기 위해 사용한다.</li>
            <li>전 장까지는 애플리케이션이 어떤 방식으로 사용자를 식별하고 특정 자원에 대한 사용자의 요청이 합법적인지 검증하는 방법에 대해 살펴봤다.</li>
            <li>접근 통제가 필요한 이유: 사용자의 요청이 특정 자원에 접근하려고 할 떼 허가된 요청인지 아닌지를 결정하는 방법이 필요하기 때문</li>
            <li>접근 톤제가 제대로 되어있지 않으면 공격자는 허가없이 애플리케이션의 자원을 이용할 수 있ㅇ므</li>
            <div>
                <h2>1. 일반적인 취약점</h2>
                <ul>
                    <li>접근 톤제는 크게 수직적인 부분과 수평적인 부분으로 구분한다.</li>
                    <ol>
                        <li>수직적 접근 통제</li>
                        <ul>
                            <li>애플리케이션의 기능에 따라 사용자의 접근을 허용할지 결정하는 방식</li>
                            <li>사용자 그룹별로 권한을  분리하는 방식</li>
                        </ul>
                        <br>
                        <li>수평적 접근 통제</li>
                        <ul>
                            <li>사용자들에게 동일한 형태의 자원에 접근할 수 있는 규칙을 제공한다.</li>
                            <li>예를 들어 웹메일 애플리케이션에서 본인의 메일은 읽을 수 있지만 다른사람의 메일은 읽을 수 없다.</li>
                        </ul>
                        <br>
                    </ol>
                    <li>대부분의 경우 수직적 접근 통제와 수평적 접근 통제는 같이 사용된다.</li>
                    <li>권한을 가지고 있지 않은 사용자가 권한이 필요한 자원이나 기능에 접근이 가능할 때 접근 통제 기능은 무력화된다</li>
                    <li>이 두 종류의 접근 통제를 무력화하기 위한 공격 방법은 크게 두 가지 종류가 있다.</li>
                    <ol>
                        <li>수직 권한 상승</li>
                        <ul>
                            <li>권한을 가지고 있지 않은 사용자가 권한이 필요한 자원에 접근하거나 권한이 필요한 기능을 실행할 수 있으면 수직 상승 권한이 이뤄진다.</li>
                            <li>예를 들어 일반 사용자가 관리자 권한을 얻는 경우 수직 권한 상승이 이뤄지며 수직 접근 통제가 무너진다.</li>
                        </ul>
                        <br>
                        <li>수평 권한 상승</li>
                        <ul>
                            <li>특정 사용자가 자신에게 제공된 권한 이외 다른 사용자의 권한에 대해서 접근이 가능할 때 수평 권한 상승이 이뤄진다.</li>
                            <li>예를 들어 다른 사용자의 웹메일을 열람하거나 수정할 수 있는 권한을 얻은 경우를 말하며, 이 경우 수평적 접근 통제는 무너진다.</li>
                        </ul>
                        <br>
                    </ol>
                    <li>애플리케이션의 수평적 권한 분리에서 취약점이 발생하면 수직적 권한 상승 공격도 야기할 수 있다.</li>
                    <div>
                        <h3>1_1. 보안 기능이 허술하게 돼있는 경우</h3>
                        <ul>
                            <li>관리자 url에 대해 접근 제어가 돼있지 않으면 해당 관리자 URL을 알고 있거나 추측할 수 있는 모든 사용자가 관라자 URL에 접근할 수 있다.</li>
                            <li>애플리케이션은 관리자 권한을 가진 사용자에게만 관리자 인터페이스를 보여주고 그 외 일반 사용자에게는 관리자 페이지를 보여주지 못하게 한다.</li>
                            <li>관리자 URL은 히스토리나 프록시 서버, 로그 등에 남져질 수 있기 때문에 관리자 페이지를 링크해놓지 않았다고 해도 접근 통제를 해 놓아야 한다.</li>
                        </ul>
                    </div>
                    <div>
                        <h3>1_2. 식별자를 기반으로 한 기능</h3>
                        <ul>
                            <li>사용자가 애플리케이션의 큭정 기능이나 자원을 요청하는 방식에는 URL상의 쿼리문자열을 이용하거나 POST요청 중 메시지 바디에 특정 정보를 포함해 해당 서버에 요청하는 방식이 있다.</li>
                            <li>해당 서버는 식별자를 확인해서 해당 디능에 대한 사용자의 요청을 판단한다.</li>
                            <li>애플리케이션 중 일부는 문서를 식별하는 코드를 무작위로 생성해서 추측하기 어렵게 만듬</li>
                            <li>애플리케이션은 무작위로 식별 코드를 생성하든지 규칙적으로 생성하든지 양쪽모두 취약점을 가지고 있다.</li>
                            <li>액세스 로그에 대한 접근 톤제가 취약하면 공격자는 접근 통제 취약점을 통해 액세스 로그로부터 중요한 정보를 수집할 수 있다.</li>
                            <li>공격자는 액세스 로그를 통해 사용자의 식별 코드를 쉽게 확인할 수 있고 수집된 정보를 이용해 또 다른 공격을 할 수 있다.</li>
                        </ul>
                    </div>
                    <div>
                        <h3>1_3. 여러 단계에 걸친 보안 기능</h3>
                        <ul>
                            <li>사용자가 애플리케이션의 특정 기능에 대해 요청할 떄 한 번이 아닌 여러 단계를 거처야짐반 해당 페이지를 보여주는 경우가 많다.</li>
                            <li>공격자가 반드시 거쳐야 하는 단계를 거치지 않고 바로 다음 단계로 넘어가게 된다면 접근 통제 효과가 무용지물이 될 수 있다.</li>
                            <li>애플리케이션이 단계마다 거친 사용자 정보를 마지막에도 검사하지 않으면 공격자는 마지막 단게에서 정보를 수정하여 검증을 우회할 수 있다.</li>
                        </ul>
                    </div>
                    <div>
                        <h3>1_4. 정적 페이지</h3>
                        <ul>
                            <li>대부분의 사용자는 서버상에서 실행되고 있는 동적 페이지에 요청을 보내 보호된 자원이나 기능에 접근할 수 있는 권한을 얻는다.</li>
                            <li>각 동적 페이지는 해당 사용자가 요청한 기능이나 자원에 적절하게 접근 통제를 수행하고 있어야 한다.</li>
                            <li>정적 자원을 요청하는 경우 사용자에 대한 권한 접근이나 요청을 검증하는 부분이 수행되기 어렵다. 즉 정적 페이지는 접근 통제를 효과적으로 적용하기 어려우며 해당 정적 페이지를 알고 있는 사용자는 별다른 인증 없이 정적 페이지에 있는 내용에 접근할 수 있다.</li>
                        </ul>
                    </div>
                    <div>
                        <h3>1_5. 안전하지 않은 접근 통제 방법</h3>
                        <ul>
                            <li>애플리케이션 중 일부는 클라이언트에서 요청하는 변수를 통해 통제를 결정하는데 이 방식은 안전하지 않다.</li>
                            <li>이와 같은 형태의 접근 통제는 관리자 권한을 가진 사용자가 실제 어떤 요청을 했는지에 대한 검증 없이는 불법적인 사용자가 관리자 권한을 수행했는지에 대해 탐지하기 어렵다.</li>
                            <li>어떤 애플리케이션은 접근 통제를 결정하는데 있어서 HTTP 참조 헤더를 이용한다.</li>
                            <li>얘를 들어 애플리케이션은 관리자 메뉴에 대해 참조(referer) 헤더를 통해 접근 통제를 강하게 설정해 놓는다.</li>
                            <li>즉 요청을 보낸 페이지가 어떤 사용자인지에 따라 권한을 결장한다는 것->참조 헤더를 통제할 수 있는 공격자는 참조 헤더 값을 변경해 원하는 정보나 기능에 접속할 수 있다.</li>
                        </ul>
                    </div>
                </ul>
            </div>
            <div>
                <h2>2. 접근 통제 공격</h2>
                <ol>
                    <li>애플리케이션에서 접근 통제 취약점을 찾기 전에 애플리케이션의 매핑에 대한 결과를 검토하고 애플리케이션에서 실제 어떤 요청이 이루어지고 있는지 먼저 이해해야 한다.</li>
                    <ul>
                        <li>그 결과를 통해 어떤 부분이 접근 통제에 무력화 될 수 있는지 파악할 수 있고, 대항 부분에 대해 집중적으로 공격해서 접근 통제를 무력화 할 서 있다.</li>
                        <li>애플리케이션에 존재하는 접근 통제를 무력화하기 위해 생각할 수 있는 질문</li>
                        <ol>
                            <li>애플리케이션 내에 사용자 별로 특정 자원에 접근하게 하는 기능이 있는가?</li>
                            <li>애플리케이션이 관리자, 일반 사용자, 게스트별로 각기 다른 기능에 접근하게 권한이 구분되어 있는가?</li>
                            <li>애플리케이션 내에 관리적인 목적으로 관리자를 위한 기능을 제공하고 있는가?</li>
                            <li>애플리케이션 내에 현재의 권한보다 더 높은 권한으로 상승할 수 있게 하는 데이터 자원이나 기능이 존재하는가?</li>
                        </ol>
                        <br>
                    </ul>
                    <li>접근 통제가 효과적으로 구성되어있는지 테스트 하기 위해 각기 다른 계정을 이용해 애플리케이션에 접근해 본다.</li>
                    <ul>
                        <li>합법적인 사용자로 해당 자원이나 기능에 접근 가능한지 확인</li>
                        <li>불법적인 사용자로 해당 자원이나 기능에 접근 가능한지 확인</li>
                        <li>해킹단계</li>
                    </ul>
                    <ol>
                        <li>애플리케이션이 수직적 접근 통제를 사용한다면 동일한 자원에 대해 다른 레벨에서 접근이 가능한지 확인</li>
                        <li>사용자 레벨별로 각기 다른 자원에 접근할 수 있게 해놓았다면 수평 권한 상승이 가능한 지 테스트</li>
                        <li>스파이더 도구를 이용해 접근 가능한 페이지 확인을 자동으로 할 수 있다.</li>
                        <li>일반 사용자의 세션을 이용해서 동작하고 있는 스파이더 프로그램이 관리자만이 접근 가능한 페이지를 발견했다면 접근 통제가 취약한 지점을 발견했다는 것을 의미</li>
                        <br>
                    </ol>
                    <li>애플리케이션에 접근할 수 있는 계정이 오직 하나이거나 전혀 없다면 접근 통제에 대한 유효성 테스트를 하기 위해 추가적인 작업이 필요</li>
                    <ul>
                        <li>예를 들어 애플리케이션에서 삭제되지 않은 오래된 기능이나 아직 일반 사용에게 공개되지 않은 새로운 기능 같은 경우가 테스트 대상임</li>
                        <br>
                    </ul>
                    <li>접근 가능한 모든 기능을 목록화하고 난 후 접근 제어가 강하게 설정되어있는지 테스트</li>
                    <ul>
                        <li>애플리케이션에서 자원에 접근하기 위해 특정 식별자를 필요로하는지 등</li>
                        <br>
                    </ul>
                </ol>
            </div>
            <div>
                <h2>3. 안전한 접근 통제</h2>
                <ul>
                    <li>실제 접근 통제를 구현할 때 발생하는 실수</li>
                    <ul>
                        <li>접근 통제를 구현할 때 피해야 하는 여러개의 함정이 있다. 이런 함정은 효과적인 접근 통제에 대한 핵심적인 요구를 잘 모르거나, 애플리케이션이 사용자의 요청에 대해 자체적으로 잘 대응할 것이라는 잘못된 가정 떄문에 발생</li>
                        <ol>
                            <li>사용자가 애플리케이션의 모든 url과 식별자를 알고 있다고 가정하고 접근 통제를 수행해야 한다.</li>
                            <li>사용자가 접송하는 변수만을 가지고 해당 요청을 신뢰하면 안된다.</li>
                            <li>사용자가 애프리케이션 페이지를 순차적으로 접근할 것이라고 가정하면 안된다.</li>
                            <li>클라이언트가 보낸 정보가 변조되지 않았을 것이라고 가정해서는 안된다.</li>
                            <br>
                        </ol>
                        <li>다음 내용들은 웹 애플리케이션에서 접근 통제를 효율적으로 수행하는 베스트 프랙티스 접근 방식이다.</li>
                        <li>베스트 프랙티스(Best-Practice) 접근 방식: 모범 사례, 접근 통제를 효과적으로 달성하기 위한 가장 성공적인 해결책이나 문제해결 방법</li>
                        <ol>
                            <li>매플리케이션의 모든 기능에 대해 접근 통제 요청을 문서화하고 정확하게 평가</li>
                            <li>사용자 세션을 통해서 모든 접근 통제 결정을 수행</li>
                            <li>중앙 애플리케이션 컨포넌트를 사용해서 접근 통제를 수행</li>
                            <li>특정 컴포넌트를 사용한 모든 개인 사용자의 요청을 프로세스화</li>
                            <li>이전 페이지에서 어떤한 예외가 발생하지 않았다는 것을 검증하기 위한 프로그램 코드를 짜야함.</li>
                            <li>관리자 페이지와 같은 중요한 기능에 대해서는 특정 IP주소만 가능하게 하거나 특정 네트워크를 사용하는 클라이언트에 한해서만 관리자 기능에 접근할 수 있게 함.</li>
                            <li>정적인 페이지에 대해서는 두 가지 방법으로 접근 제어를 강화할 수 있다.</li>
                            <ol>
                                <li>사용자가 정적 페이지를 요청할 때 해당 요청을 접근 통제 로직을 구현할 수 있는 동적 서버 측 페이지에게 전달하여 사용자 권한을 검증하는 간접적인 방법으로 접근 제어</li>
                                <li>http인증과 같이 애플리케이션 서버가 사용자 권한을 확인할 수 있는 기능을 사용하여 접근 제어</li>
                                <br>
                            </ol>
                            <li>특정 데이터를 요청한 사용자가 인증된 사용자인지 확인하기 위해서는 서버 특 데이터만 신뢰해야 하고 사용자가 보낸 데이터는 다시 한번 서버 측에서 검증</li>
                            <li>온라인 뱅킹에서 사용하는 계좌 이체와 같은 보안상 민감안 애플리케이션은 재인증이나 이중 인증과 같은 추가적인 검증 기능을 포함해야 한다.</li>
                            <li>로그를 통해 잘 보이지 않고 찾기 힘들었던 접근 통제의 취약한 부분을 확인할 수 있음</li>
                            <br>
                        </ol>
                        <li>접근 통제 코드를 나눠 사용하는 경우 실수로 기능 구현을 안하는 경우도 있으며, 다른 페이지에서 코드가 구현이 안되는 경우도 있다.</li>
                        <li>접근 통제를 강화하는 방법으로 중앙 집중 애플리케이션 컴포넌트를 이용하면 다양한 이점을 얻을 수 있다.</li>
                        <li>중앙 집중 애플리케이션 컴포넌트: </li>
                        <li>Vuex: 웹 애플리케이션 사용자 인터페이스를 만들기 위해 사용하는 오픈 소스 프로그래시브 자바스크립트 프레임워크, 애플리케이션에 대한 상태 관리 패턴, 라이브러리 역할</li>
                    </ul>
                    <div>
                        <h3>1. 다계층 접근 통제 모델</h3>
                        <ul>
                            <li>접근 통제와 관련된 문제는 웹 애플리케이션 자체뿐 아니라 그 밑에 존대하는 서버, DB, 운영체제와 밀접한 관련이 있다.</li>
                            <li>심층 보안 접근은 여러 개의 안전한 계층을 만들고 각 계층마다 접근 통제를 수행</li>
                            <li>공격자가 하나의 계층에 있는 접근 통제를 무력화 하더라도 다른 계층에서 구현된 보안이 공격을 막을 수 있기 때문에 유용한 모델로 쓰인다.</li>
                            <ul>
                                <li>서버는 서버측에서 정의한 사용자 규칙 기반을 이용해 전체 URL 경로에 대해 접근 통제를 수행할 수 있음</li>
                                <li>애플리케이션은 사용자 별로 개별 행동에 대해서 각기 다른 데이터베이스 계정을 사용할 수 있음</li>
                                <li>데이터베이스에 있는 권한 테이블을 이용해서 사용자가 애플리케이션을 통해 다른 테이블에 접근하는 시도를 통제할 수 있다.</li>
                                <li>운영체제에서 사용하는 계정을 통해 데이터베이스를 이용할 떄는 가장 낮은 수준의 권한을 이용해 접근 통제를 수행 할 수 있다.</li>
                                <br>
                            </ul>
                            <li>권한 매트릭스: 사용자의 모든 역할과 시스템 기능 그리고 특별한 기능을 수행하는데에 필요한 러가등을 grid(격자)형태로 나타낸다.</li>
                            <li>다계층 보안 모델에서는 다양한 방법으로 접근 통제를 적용할 수 있다.</li>
                            <ul>
                                <li>프로그램적 통제: 데이터베이스에 대한 개별적인 권한 매트릭스는 데이어베이스 내에 있는 테이블에 저장되고, 접근 통제에 대한 사용자의 역할 분류는 프로그램에 의해 적용된다.</li>
                                <li>임의 접근 통제: 관리자들은 개별 계정에 자신이 소유하고 있는 권한을 위임하거나 다른 계정의 권한을 잠그거나 해제할 수 있다. </li>
                                <li>DAC 모델: 임의 접근 통제, 접근을 요청하는 자의 신원, 그리고 어떤 사람이 접근 승인이 되는지를 나타내는 접근 규칙에 기반을 두는 접근 제어</li>
                                <li>규칙기반 접근 통제: 애플리케이션에 대해 특정 권한을 부여하는 규칙을 정하고 각 사용자를 이런 큐칙 중의 하나에 할당하는 방식</li>
                            </ul>
                        </ul>
                    </div>
                </ul>
            </div>
        </ul>
        <br>
        <br>
        <div>
            <h2>Questions</h2>
            <ul>
                <li>1_2에서 액세스 로그에 대한 접근 통제가 취약하면 액세스 로그를 통해 중요 정보를 탈취당할 수 있다고 나와있는데 페이지에 대한 접근 통제 뿐 아니라 식별자 코드, 로그에 대한 접근 통제까지 해야 되나?</li>
                <li>중앙 집중 애플리케이션 컴포넌트가 무엇인가? Vuex같은 것인가?</li>
            </ul>
        </div>
    </body>
</html>
